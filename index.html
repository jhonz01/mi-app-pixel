<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pa' ti mi cachetona üíñ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #222;
      font-family: 'Press Start 2P', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      overflow: hidden;
    }

    h1 {
      margin: 10px 0 5px;
      font-size: 5vw;
      color: #fff;
      text-shadow: 2px 2px 0 #000;
      letter-spacing: 2px;
      text-align: center;
    }

    /* üü© Contenedor del juego centrado y fijo */
    .game-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 50%;
    }

    .game-container {
      position: relative;
      width: 90vw;
      max-width: 420px;
      aspect-ratio: 16 / 9;
      border: 4px solid #444;
      border-radius: 10px;
      background: #111;
      overflow: hidden;
      box-shadow: 0 0 20px #0006;
    }

    #gameCanvas {
      width: 100%;
      height: auto; /* üëà mantiene proporci√≥n */
      image-rendering: pixelated;
      display: block;
    }

    /* üó®Ô∏è Mensaje fijo */
    #mensaje {
      background: rgba(0,0,0,0.7);
      color: #fff;
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 3.5vw;
      box-shadow: 0 2px 8px #0006;
      width: 80%;
      text-align: center;
      margin: 10px 0;
      white-space: normal;
      word-wrap: break-word;
    }

    /* üéÆ Botones */
    .controles {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 10px;
    }

    .controles button {
      background: #222;
      border: 4px solid #fff;
      color: #fff;
      font-family: 'Press Start 2P', Arial, sans-serif;
      font-size: 3vw;
      padding: 8px 12px;
      cursor: pointer;
      box-shadow: 4px 4px 0 #000;
      transition: all 0.1s;
      min-width: 80px;
    }

    .controles button:active {
      background: #ff66a3;
      color: #000;
      box-shadow: 2px 2px 0 #000;
      transform: translate(2px,2px);
    }
  </style>
</head>
<body>
  <h1>Pa' ti mi cachetona üíñ</h1>

  <div class="game-section">
    <div class="game-container">
      <canvas id="gameCanvas" width="320" height="160"></canvas>
    </div>
    <div id="mensaje">Pa‚Äô ti mi cachetona hermosa üåπ</div>
  </div>

  <div class="controles">
    <button id="btnAutoWalk">MOVE</button>
    <button id="btnMusica">PLAY</button>
    <button id="btnVoz">VOICE</button>
    <button id="btnMensaje">MSG</button>
  </div>

  <audio id="musica" src="musica.mp3"></audio>
  <audio id="voz" src="mi_voz.mp3"></audio>

  <script>
    const mensajes = [
      "Pa‚Äô ti mi cachetona hermosa üåπ",
      "Te extra√±o mucho üíñ",
      "Eres mi persona favorita üòò",
      "Siempre pienso en ti ü•∞",
      "¬°Sonr√≠e, mi amor! üòä",
      "T√∫ eres mi cielo üåà",
      "¬°Te amo infinito! üíû",
      "Eres mi pixel preferido üü™",
      "Quiero abrazarte ya ü´Ç",
      "¬°Eres mi raz√≥n de sonre√≠r! üòç"
    ];

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    ctx.imageSmoothingEnabled = false;

    const sprites = {
      idle: new Image(),
      walk: new Image(),
      ellaIdle: new Image(),
      ellaWalk: new Image()
    };
    sprites.idle.src = "sprites/idle.png";
    sprites.walk.src = "sprites/walk.png";
    sprites.ellaIdle.src = "sprites/ella_idle.png";
    sprites.ellaWalk.src = "sprites/ella_walk.png";

    const sueloAltura = 40;
    const SCALE = 1.5;

    let player = { x: 0, y: canvas.height - sueloAltura - 32*SCALE, width: 32*SCALE, height: 32*SCALE, frame: 0, frameCount: 4, speed: 1.5, action: "idle", autoWalk: false };
    let ella = { x: canvas.width - 32*SCALE, y: canvas.height - sueloAltura - 32*SCALE, width: 32*SCALE, height: 32*SCALE, frame: 0, frameCount: 4, speed: 1.5, action: "idle", autoWalk: false };

    let corazones = [];
    function nuevoMensaje() {
      document.getElementById("mensaje").innerText = mensajes[Math.floor(Math.random()*mensajes.length)];
    }
    document.getElementById("btnMensaje").onclick = nuevoMensaje;
    document.getElementById("mensaje").onclick = nuevoMensaje;

    document.getElementById("btnAutoWalk").onclick = () => {
      player.x = 0;
      ella.x = canvas.width - ella.width;
      player.action = "walk";
      ella.action = "walk";
      player.autoWalk = true;
      ella.autoWalk = true;
      corazones = [];
    };

    const musica = document.getElementById("musica");
    document.getElementById("btnMusica").onclick = () => musica.paused ? musica.play() : musica.pause();
    const voz = document.getElementById("voz");
    document.getElementById("btnVoz").onclick = () => { voz.currentTime = 0; voz.play(); };

    let estrellas = Array.from({length: 50}, () => ({x: Math.random()*canvas.width,y: Math.random()*(canvas.height - sueloAltura),brillo: Math.random()}));
    let fugaces = [];
    function generarFugaces() {
      let cantidad = Math.floor(Math.random()*4);
      for (let i=0; i<cantidad; i++) {
        fugaces.push({x: Math.random()*canvas.width,y: Math.random()*canvas.height/2,vx: -2 - Math.random()*2,vy: 1 + Math.random()*1,vida: 50 + Math.random()*50});
      }
    }
    setInterval(generarFugaces, 8000);

    let clouds = Array.from({length: 5}, () => ({
      x: Math.random()*canvas.width,
      y: 20 + Math.random()*40,
      size: 24 + Math.random()*20,
      speed: 0.03 + Math.random()*0.02
    }));

    function getMoonPhaseFraction() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth() + 1;
      const day = now.getDate();
      const c = 29.530588853;
      const n = day + (year-2000)*365.25 + month*30.6;
      return (n % c)/c;
    }

    function dibujarEscenario() {
      let hora = new Date().getHours();
      let colorCielo;
      if (hora >= 5 && hora < 8) colorCielo = '#FFB36B';
      else if (hora >= 8 && hora < 17) colorCielo = '#87CEEB';
      else if (hora >= 17 && hora < 19) colorCielo = '#FF7E5E';
      else colorCielo = '#0B0033';
      ctx.fillStyle = colorCielo;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      if (hora >= 19 || hora < 5) {
        estrellas.forEach(e=>{
          e.brillo += (Math.random()-0.5)*0.1;
          e.brillo = Math.max(0.2, Math.min(1, e.brillo));
          ctx.fillStyle = `rgba(255,255,255,${e.brillo})`;
          ctx.fillRect(Math.floor(e.x), Math.floor(e.y), 1, 1);
        });
        fugaces.forEach(f=>{
          ctx.strokeStyle = 'white';
          ctx.beginPath();
          ctx.moveTo(f.x,f.y);
          ctx.lineTo(f.x+5,f.y-2);
          ctx.stroke();
          f.x += f.vx; f.y += f.vy; f.vida--;
        });
        fugaces = fugaces.filter(f=>f.vida>0);
      }

      if (hora>=6 && hora<19){
        let sunProgress = (hora-6)/13;
        let sunX = sunProgress*canvas.width;
        let sunY = 40 - Math.sin(sunProgress*Math.PI)*30;
        ctx.fillStyle = '#FFD700';
        ctx.fillRect(sunX, sunY, 24,24);
      }

      if (hora>=19 || hora<6){
        let moonProgress = (hora>=19? (hora-19)/11 : (hora+5)/11);
        let moonX = canvas.width - moonProgress*canvas.width;
        let moonY = 40 - Math.sin(moonProgress*Math.PI)*30;
        let phase = getMoonPhaseFraction();
        ctx.fillStyle = '#CCCCCC';
        ctx.fillRect(moonX, moonY, 24,24);
        ctx.fillStyle = colorCielo;
        ctx.fillRect(moonX+24*phase, moonY, 24*(1-phase),24);
      }

      clouds.forEach(cl=>{
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(cl.x, cl.y, cl.size, cl.size/2);
        ctx.fillRect(cl.x+cl.size/4, cl.y-2, cl.size/2, cl.size/2);
        cl.x += cl.speed;
        if (cl.x>canvas.width) cl.x=-cl.size;
      });

      ctx.fillStyle = '#228B22';
      ctx.fillRect(0,canvas.height - sueloAltura,canvas.width,sueloAltura);
    }

    let frameTimer = 0;
    function update() {
      frameTimer++;
      if (frameTimer % 10 === 0){
        player.frame = (player.frame + 1) % player.frameCount;
        ella.frame = (ella.frame + 1) % ella.frameCount;
      }
      let centroX = (canvas.width - player.width)/2 - player.width/2;
      let centroElla = (canvas.width - ella.width)/2 + ella.width/2;
      if (player.autoWalk) {
        if (player.x < centroX) player.x += player.speed; else {player.x = centroX;player.action = "idle";}
      }
      if (ella.autoWalk) {
        if (ella.x > centroElla) ella.x -= ella.speed; else {ella.x = centroElla;ella.action = "idle";}
      }
      if (player.action==="idle" && ella.action==="idle" && corazones.length===0){
        for (let i=0; i<10; i++){
          corazones.push({x: (player.x+ella.x)/2+player.width/2,y: player.y,vy: -1-Math.random()*1,vida: 60+Math.random()*40});
        }
      }
      draw();
      requestAnimationFrame(update);
    }

    function draw() {
      dibujarEscenario();
      let sprite1 = sprites[player.action];
      ctx.drawImage(sprite1,player.frame * 32, 0, 32, 32,player.x, player.y, player.width, player.height);
      let sprite2 = sprites["ella"+capitalize(ella.action)];
      ctx.save();
      ctx.translate(ella.x + ella.width, ella.y);
      ctx.scale(-1,1);
      ctx.drawImage(sprite2,ella.frame * 32, 0, 32, 32,0, 0, ella.width, ella.height);
      ctx.restore();
      corazones.forEach(c=>{
        ctx.fillStyle = 'pink';
        ctx.fillRect(c.x,c.y,2,2);
        ctx.fillRect(c.x-1,c.y+1,1,1);
        ctx.fillRect(c.x+2,c.y+1,1,1);
        c.y += c.vy;
        c.vida--;
      });
      corazones = corazones.filter(c=>c.vida>0);
    }

    function capitalize(str){ return str.charAt(0).toUpperCase()+str.slice(1); }
    update();
  </script>
</body>
</html>
