<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title> JELOUUU TE AMO MI VALE ‚ù§Ô∏è</title>

  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#222" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #222;
      font-family: 'Press Start 2P', Arial, sans-serif;
      text-align: center;
      height: 100%;
      width: 100vw;
    }
    h1 {
      margin: 10px 0 0 0;
      font-size: 5vw;
      color: #fff;
      text-shadow: 2px 2px 0 #000;
      letter-spacing: 2px;
    }
    #mensaje {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      color: #fff;
      padding: 10px 18px;
      border-radius: 12px;
      display: inline-block;
      font-size: 4vw;
      box-shadow: 0 2px 8px #0006;
      min-width: 60vw;
      max-width: 90vw;
      z-index: 9;
    }
    #gameCanvas {
      display: block;
      margin: 0 auto;
      background: #222;
      width: 100vw;
      max-width: 100vw;
      height: 60vw;
      max-height: 70vw;
      image-rendering: pixelated;
      border: 2px solid #333;
    }
    .controles {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: 10;
      width: 95vw;
      justify-content: center;
      flex-wrap: wrap;
    }
    .controles button {
      background: #222;
      border: 4px solid #fff;
      color: #fff;
      font-family: 'Press Start 2P', Arial, sans-serif;
      font-size: 3vw;
      padding: 8px 12px;
      cursor: pointer;
      image-rendering: pixelated;
      box-shadow: 4px 4px 0 #000;
      transition: all 0.1s;
      min-width: 80px;
    }
    .controles button:active {
      background: #ff66a3;
      color: #000;
      box-shadow: 2px 2px 0 #000;
      transform: translate(2px,2px);
    }
    @media (max-width: 600px) {
      h1 { font-size: 7vw; }
      #mensaje { font-size: 5vw; }
      #gameCanvas { height: 60vw; }
      .controles button { font-size: 4vw; min-width: 60px; }
    }
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    #spotifyPlayer {
  width: 95%;
  max-width: 320px;
  height: 150px;
  margin: 25px auto;
  border: 4px solid #fff;
  background: #222;
  box-shadow: 4px 4px 0 #000;
  border-radius: 8px;
  overflow: hidden;
}
#spotifyPlayer iframe {
  width: 100%;
  height: 100%;
  border: none;
}
@media (max-width: 600px) {
  #spotifyPlayer { height: 130px; margin: 20px auto; }
}


  </style>
</head>
<body>
  <h1> JELOUUU TE AMO MI VALE ‚ù§Ô∏è</h1>
  <canvas id="gameCanvas" width="320" height="160"></canvas>

<!-- NUEVO: reproductor Spotify -->
<div id="spotifyPlayer"></div>

<div id="mensaje"> JELOUUU TE AMO MI VALE ‚ù§Ô∏è</div>

  <div class="controles">
    <button id="btnAutoWalk">MOVE</button>
    <button id="btnVoz">VOICE</button>
    <button id="btnMensaje">MSG</button>
  </div>



  <script>
'use strict';
function dibujarSolYLunaPixel() {
  const hora = new Date().getHours() + new Date().getMinutes()/60;
  const size = 16; // tama√±o del cuadrado (pixelart)
  
  // --- SOL (6 a 18) ---
  if (hora >= 6 && hora < 18) {
    const t = (hora - 6) / 12;
    const x = t * canvas.width;
    const y = Math.sin(t * Math.PI) * 50 + 60;
    
    ctx.fillStyle = "#FFD93B";
    ctx.fillRect(x - size/2, y - size/2, size, size);
  }

  // --- LUNA (18 a 6) ---
  else {
    let t;
    if (hora >= 18) t = (hora - 18) / 12;
    else t = (hora + 6) / 12;
    const x = t * canvas.width;
    const y = Math.sin(t * Math.PI) * 50 + 60;

    const hoy = new Date();
    const lp = 2551443;
    const ahora = hoy.getTime()/1000;
    const lunaNueva = new Date("2025-10-06T00:00:00Z").getTime()/1000;
    const fase = ((ahora - lunaNueva) % lp) / lp;

    ctx.fillStyle = "#F5F3CE";
    ctx.fillRect(x - size/2, y - size/2, size, size);

    const faseNormal = Math.cos(fase * 2 * Math.PI);
    ctx.fillStyle = "#0B0033";

    if (faseNormal > 0) ctx.fillRect(x, y - size/2, size/2, size);
    else ctx.fillRect(x - size/2, y - size/2, size/2, size);
  }
}


const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

const sprites = {
  idle: new Image(),
  walk: new Image(),
  ellaIdle: new Image(),
  ellaWalk: new Image(),
  corazones: new Image(),
  suelo: new Image(),
  fondoDia: new Image(),
  fondoTarde: new Image(),
  fondoNoche: new Image()
};

sprites.idle.src = "sprites/idle.png";
sprites.walk.src = "sprites/walk.png";
sprites.ellaIdle.src = "sprites/ella_idle.png";
sprites.ellaWalk.src = "sprites/ella_walk.png";
sprites.corazones.src = "sprites/corazones_animados.png";
sprites.suelo.src = "sprites/suelo.png";
sprites.fondoDia.src = "sprites/fondo_nubes_dia.png";
sprites.fondoTarde.src = "sprites/fondo_nubes_tarde.png";
sprites.fondoNoche.src = "sprites/fondo_nubes_noche.png";

let player = { x: 0, y: canvas.height - 64, width: 32, height: 32, frame: 0, frameCount: 4, speed: 1.5, action: "idle", autoWalk: false };
let ella = { x: canvas.width - 32, y: canvas.height - 64, width: 32, height: 32, frame: 0, frameCount: 4, speed: 1.5, action: "idle", autoWalk: false };



document.getElementById("btnAutoWalk").onclick = () => {
  player.x = 0;
  ella.x = canvas.width - ella.width;
  player.action = "walk";
  ella.action = "walk";
  player.autoWalk = true;
  ella.autoWalk = true;
};


const voces = [
  "voz/voz1.mp3",
  "voz/voz2.mp3",
  "voz/voz3.mp3",
  "voz/voz4.mp3"
];

const mensajes = [
  "Pa‚Äô ti mi cachetona hermosa üåπ",
  "Te extra√±o mucho üíñ",
  "Eres mi persona favorita üòò",
  "Siempre pienso en ti ü•∞",
  "¬°Sonr√≠e, mi amor! üòä",
  "T√∫ eres mi cielo üåà",
  "¬°Te amo infinito! üíû",
  "Eres mi pixel preferido üü™",
  "Quiero abrazarte ya ü´Ç",
  "¬°Eres mi raz√≥n de sonre√≠r! üòç"
];

// --- üì¶ FUNCIONES DE ALEATORIEDAD SIN REPETIR ---
function crearCola(lista, key) {
  const guardados = JSON.parse(localStorage.getItem(key) || "[]");
  const pendientes = lista.filter(item => !guardados.includes(item));
  if (pendientes.length === 0) {
    localStorage.setItem(key, "[]");
    return crearCola(lista, key);
  }
  const elegido = pendientes[Math.floor(Math.random() * pendientes.length)];
  guardados.push(elegido);
  localStorage.setItem(key, JSON.stringify(guardados));
  return elegido;
}



// --- üé§ VOZ (pausa m√∫sica mientras suena) ---
document.getElementById("btnVoz").onclick = async () => {
  const voz = crearCola(voces, "vocesUsadas");
  const audioVoz = new Audio(voz);

  // üéß Crear contexto de audio para aplicar efectos suaves
  const context = new (window.AudioContext || window.webkitAudioContext)();
  const gainNode = context.createGain();
  const source = context.createMediaElementSource(audioVoz);
  source.connect(gainNode).connect(context.destination);

  // Intentar activar el contexto (algunos navegadores lo requieren manualmente)
  try { await context.resume(); } catch {}

  // üéµ Bajar volumen global de la p√°gina (efecto fade out)
  const iframes = document.querySelectorAll("iframe");
  iframes.forEach(frame => frame.style.transition = "filter 0.5s ease");
  iframes.forEach(frame => frame.style.filter = "brightness(0.6)");

  // Simular que la m√∫sica baja poco a poco
  gainNode.gain.linearRampToValueAtTime(0.1, context.currentTime + 0.5);

  // ‚ñ∂Ô∏è Reproducir tu voz
  audioVoz.play();

  audioVoz.onended = () => {
    // üîä Restaurar volumen (efecto fade in)
    gainNode.gain.linearRampToValueAtTime(1, context.currentTime + 0.5);

    iframes.forEach(frame => frame.style.filter = "brightness(1)");
  };
};



// --- üíå MENSAJES ---
function nuevoMensaje() {
  const msg = crearCola(mensajes, "mensajesUsados");
  document.getElementById("mensaje").innerText = msg;
}
document.getElementById("btnMensaje").onclick = nuevoMensaje;
document.getElementById("mensaje").onclick = nuevoMensaje;


let estrellas = Array.from({length: 50}, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * (canvas.height - 32),
  brillo: Math.random()
}));

let fugaces = [];
function generarFugaces() {
  let cantidad = Math.floor(Math.random()*4);
  for (let i=0; i<cantidad; i++) {
    fugaces.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height/2, vx: -2 - Math.random()*2, vy: 1 + Math.random()*1, vida: 50 + Math.random()*50});
  }
}
setInterval(generarFugaces, 8000);

let clouds = Array.from({length: 5}, () => ({
  x: Math.random()*canvas.width,
  y: 20 + Math.random()*40,
  size: 10 + Math.random()*15,
  speed: 0.02 + Math.random()*0.02
}));

let frameCorazon = 0;
const anchoCorazon = 286 / 13;
const altoCorazon = 60;
let frameTimer = 0;

function capitalize(str){ return str.charAt(0).toUpperCase()+str.slice(1); }

function dibujarEscenario() {
  let hora = new Date().getHours();
  let colorCielo;
  if (hora >= 5 && hora < 8) colorCielo = '#FFB36B';
  else if (hora >= 8 && hora < 17) colorCielo = '#87CEEB';
  else if (hora >= 17 && hora < 19) colorCielo = '#FF7E5E';
  else colorCielo = '#0B0033';
  ctx.fillStyle = colorCielo;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  let fondoActual;
  if (hora >= 8 && hora < 17) fondoActual = sprites.fondoDia;
  else if (hora >= 17 && hora < 19) fondoActual = sprites.fondoTarde;
  else fondoActual = sprites.fondoNoche;
  if (fondoActual.complete && fondoActual.naturalWidth > 0)
    ctx.drawImage(fondoActual, 0, 0, canvas.width, canvas.height);

  if (hora >= 19 || hora < 5) {
    estrellas.forEach(e=>{
      e.brillo += (Math.random()-0.5)*0.1;
      e.brillo = Math.max(0.2, Math.min(1, e.brillo));
      ctx.fillStyle = `rgba(255,255,255,${e.brillo})`;
      ctx.fillRect(Math.floor(e.x), Math.floor(e.y), 1, 1);
    });
    fugaces.forEach(f=>{
      ctx.strokeStyle = 'white';
      ctx.beginPath();
      ctx.moveTo(f.x,f.y);
      ctx.lineTo(f.x+5,f.y-2);
      ctx.stroke();
      f.x += f.vx; f.y += f.vy; f.vida--;
    });
    fugaces = fugaces.filter(f=>f.vida>0);
  }

  clouds.forEach(cl=>{
    ctx.fillStyle = '#FFFFFF';
    ctx.fillRect(cl.x, cl.y, cl.size, cl.size/2);
    ctx.fillRect(cl.x+cl.size/4, cl.y-2, cl.size/2, cl.size/2);
    cl.x += cl.speed;
    if (cl.x>canvas.width) cl.x=-cl.size;
  });

  const tiles = Math.ceil(canvas.width / 320);
  for (let i = 0; i < tiles; i++)
    ctx.drawImage(sprites.suelo, i * 320, canvas.height - 32, 320, 32);
}

function update() {
  frameTimer++;
  if (frameTimer % 10 === 0){
    player.frame = (player.frame + 1) % player.frameCount;
    ella.frame = (ella.frame + 1) % ella.frameCount;
    frameCorazon = (frameCorazon + 1) % 13;
  }

  const centroX = (canvas.width - player.width)/2 - player.width/2;
  const centroElla = (canvas.width - ella.width)/2 + ella.width/2;

  if (player.autoWalk) {
    if (player.x < centroX) player.x += player.speed;
    else { player.x = centroX; player.action = "idle"; player.autoWalk = false; }
  }
  if (ella.autoWalk) {
    if (ella.x > centroElla) ella.x -= ella.speed;
    else { ella.x = centroElla; ella.action = "idle"; ella.autoWalk = false; }
  }

  dibujarEscenario();
  dibujarSolYLunaPixel();

  ctx.drawImage(sprites[player.action], player.frame * player.width, 0, player.width, player.height, player.x, player.y, player.width, player.height);
  ctx.save();
  ctx.translate(ella.x + ella.width, ella.y);
  ctx.scale(-1,1);
  ctx.drawImage(sprites["ella"+capitalize(ella.action)], ella.frame * ella.width, 0, ella.width, ella.height, 0, 0, ella.width, ella.height);
  ctx.restore();

  // üíñ Mostrar corazones solo si AMBOS est√°n en idle y EN EL CENTRO
  const enCentro = 
    Math.abs(player.x - centroX) < 1 && 
    Math.abs(ella.x - centroElla) < 1;

  if (enCentro && player.action === "idle" && ella.action === "idle") {
    const centroXCorazon = (player.x + ella.x + player.width) / 2 - anchoCorazon / 2;
    const centroYCorazon = player.y - altoCorazon + 10;
    ctx.drawImage(sprites.corazones, frameCorazon * anchoCorazon, 0, anchoCorazon, altoCorazon, centroXCorazon, centroYCorazon, anchoCorazon, altoCorazon);
  }

  requestAnimationFrame(update);
}

const spotifyPlayer = document.getElementById("spotifyPlayer");
spotifyPlayer.innerHTML = `
<iframe style="border-radius:0;" 
        src="https://open.spotify.com/embed/playlist/5V6gI1wluJC8I1AqIVlt2T?utm_source=generator&theme=0" 
        width="100%" height="100%" frameBorder="0" 
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
        loading="lazy"></iframe>`;

// --- Registro del Service Worker (para PWA) ---
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js')
  .then(() => console.log("‚úÖ Service Worker registrado correctamente"))
  .catch(err => console.log("‚ùå Error al registrar el Service Worker:", err));
}

update();
  </script>
</body>
</html>
