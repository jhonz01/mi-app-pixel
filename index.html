<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pa' ti mi cachetona ðŸ’–</title>
<style>
  body {
    background-color: #000;
    margin: 0;
    overflow: hidden;
    font-family: 'Press Start 2P', cursive;
    color: white;
    text-align: center;
  }
  h1 {
    margin-top: 10px;
    font-size: 16px;
  }
  canvas {
    background-color: #000;
    display: block;
    margin: 10px auto;
    image-rendering: pixelated;
  }
  #msgBox {
    margin-top: 10px;
    font-size: 12px;
    background: rgba(255,255,255,0.1);
    padding: 5px;
    border-radius: 8px;
    display: inline-block;
  }
  .btn {
    margin: 5px;
    padding: 5px 10px;
    border: none;
    border-radius: 6px;
    background: #ff69b4;
    color: white;
    cursor: pointer;
    font-size: 10px;
  }
  .btn:hover { background: #ff85c2; }
  @media (max-width:600px){
    canvas{ width:95vw; height:auto; }
  }
</style>
</head>
<body>
  <h1>Paâ€™ ti mi cachetona ðŸ’–</h1>
  <canvas id="gameCanvas" width="480" height="240"></canvas>
  <div>
    <button class="btn" id="btnMove">MOVE</button>
    <button class="btn" id="btnPlay">PLAY</button>
    <button class="btn" id="btnVoice">VOICE</button>
    <button class="btn" id="btnMsg">MSG</button>
  </div>
  <div id="msgBox">Eres mi persona favorita ðŸ’ž</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// --- Sprites ---
const player = {x:20, y:150, frame:0, frameCount:4, width:32, height:32, speed:1.5, action:"idle", autoWalk:false};
const ella = {x:430, y:150, frame:0, frameCount:4, width:32, height:32, speed:1.5, action:"idle", autoWalk:false};

const sprites = {
  idle: new Image(),
  walk: new Image(),
  ella_idle: new Image(),
  ella_walk: new Image(),
  suelo: new Image(),
  nubesDia: new Image(),
  nubesTarde: new Image(),
  nubesNoche: new Image()
};

sprites.idle.src = "sprites/idle.png";
sprites.walk.src = "sprites/walk.png";
sprites.ella_idle.src = "sprites/ella_idle.png";
sprites.ella_walk.src = "sprites/ella_walk.png";
sprites.suelo.src = "sprites/suelo.png";
sprites.nubesDia.src = "sprites/fondo_nubes_dia.png";
sprites.nubesTarde.src = "sprites/fondo_nubes_tarde.png";
sprites.nubesNoche.src = "sprites/fondo_nubes_noche.png";

// --- MÃºsica y voz ---
const musica = new Audio("musica.mp3");
musica.loop = true;
const voz = new Audio("mi_voz.mp3");

// --- Mensajes ---
const mensajes = [
  "Eres mi persona favorita ðŸ’ž",
  "Contigo todo es bonito ðŸŒ¸",
  "Eres mi paz y mi caos bonito ðŸ’«",
  "Mi cachetona preciosa ðŸ’–",
  "Gracias por existir ðŸ’•"
];
let msgIndex = 0;
document.getElementById("btnMsg").onclick = () => {
  msgIndex = (msgIndex + 1) % mensajes.length;
  document.getElementById("msgBox").textContent = mensajes[msgIndex];
};

// --- Botones ---
document.getElementById("btnPlay").onclick = () => {
  if (musica.paused) musica.play(); else musica.pause();
};
document.getElementById("btnVoice").onclick = () => { voz.play(); };
document.getElementById("btnMove").onclick = () => {
  player.action = "walk"; ella.action = "walk";
  player.autoWalk = true; ella.autoWalk = true;
};

// --- Variables del fondo ---
let hora = new Date().getHours();
let fase;
if (hora >= 6 && hora < 12) fase = "amanecer";
else if (hora >= 12 && hora < 18) fase = "dia";
else if (hora >= 18 && hora < 20) fase = "tarde";
else fase = "noche";

let frameTimer = 0;

// --- Corazones animados personalizados ---
const heartSprite = new Image();
heartSprite.src = "sprites/heart.png"; // su archivo (286x60, 13 frames)
const heart = {
  frame: 0,
  frameCount: 13,
  width: 286 / 13, // ~22 px cada frame
  height: 60,
  frameSpeed: 6,
  timer: 0
};
let heartVisible = false;

// ---- FUNCIONES NUEVAS ----
function actualizarCorazones() {
  // Calcula las posiciones donde deberÃ­an estar ambos en el centro
  let centroX = (canvas.width - player.width) / 2 - player.width / 2;
  let centroElla = (canvas.width - ella.width) / 2 + ella.width / 2;

  // Verifica si ambos estÃ¡n muy cerca del centro y en "idle"
  let ambosCentro =
    Math.abs(player.x - centroX) < 1 &&
    Math.abs(ella.x - centroElla) < 1 &&
    player.action === "idle" &&
    ella.action === "idle";

  heartVisible = ambosCentro;

  // Control del frame de animaciÃ³n
  if (heartVisible) {
    heart.timer++;
    if (heart.timer % heart.frameSpeed === 0) {
      heart.frame = (heart.frame + 1) % heart.frameCount;
    }
  }
}

function dibujarCorazones() {
  if (!heartVisible) return;

  // Punto medio exacto entre ambos personajes
  const midX = (player.x + player.width / 2 + ella.x + ella.width / 2) / 2;
  const midY = Math.min(player.y, ella.y) - heart.height / 2;

  // Ajuste para centrar la imagen del corazÃ³n en el punto medio
  const drawX = midX - heart.width / 2;
  const drawY = midY - 10; // ligeramente arriba de las cabezas

  ctx.drawImage(
    heartSprite,
    heart.frame * heart.width, 0, heart.width, heart.height,
    drawX, drawY, heart.width, heart.height
  );
}
// ---- FIN FUNCIONES NUEVAS ----

// --- Dibujo del fondo dinÃ¡mico ---
function drawFondo() {
  ctx.save();
  if (fase === "amanecer") {
    let grad = ctx.createLinearGradient(0,0,0,canvas.height);
    grad.addColorStop(0,"#FFB347");
    grad.addColorStop(1,"#FFD194");
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  } else if (fase === "dia") {
    ctx.fillStyle = "#87CEEB";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(sprites.nubesDia, (frameTimer*0.3)%canvas.width - canvas.width, 20);
    ctx.drawImage(sprites.nubesDia, (frameTimer*0.3)%canvas.width, 20);
  } else if (fase === "tarde") {
    ctx.fillStyle = "#FAD0C4";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(sprites.nubesTarde, (frameTimer*0.2)%canvas.width - canvas.width, 30);
    ctx.drawImage(sprites.nubesTarde, (frameTimer*0.2)%canvas.width, 30);
  } else {
    ctx.fillStyle = "#001848";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(sprites.nubesNoche, (frameTimer*0.1)%canvas.width - canvas.width, 40);
    ctx.drawImage(sprites.nubesNoche, (frameTimer*0.1)%canvas.width, 40);
  }
  ctx.restore();
}

// --- Dibujo general ---
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawFondo();
  ctx.drawImage(sprites.suelo,0,player.y+player.height,canvas.width,20);
  ctx.drawImage(
    player.action==="idle"?sprites.idle:sprites.walk,
    player.frame*player.width,0,player.width,player.height,
    player.x,player.y,player.width,player.height
  );
  ctx.drawImage(
    ella.action==="idle"?sprites.ella_idle:sprites.ella_walk,
    ella.frame*ella.width,0,ella.width,ella.height,
    ella.x,ella.y,ella.width,ella.height
  );

  dibujarCorazones();
}

// --- Bucle principal ---
function update() {
  frameTimer++;
  if (frameTimer % 10 === 0){
    player.frame = (player.frame + 1) % player.frameCount;
    ella.frame = (ella.frame + 1) % ella.frameCount;
  }

  let centroX = (canvas.width - player.width)/2 - player.width/2;
  let centroElla = (canvas.width - ella.width)/2 + ella.width/2;
  if (player.autoWalk) {
    if (player.x < centroX) player.x += player.speed; else {player.x = centroX;player.action = "idle";}
  }
  if (ella.autoWalk) {
    if (ella.x > centroElla) ella.x -= ella.speed; else {ella.x = centroElla;ella.action = "idle";}
  }

  actualizarCorazones(); // actualiza la animaciÃ³n de corazones
  draw();
  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
