<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Pa' ti mi cachetona üíñ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #232946;
      font-family: 'Press Start 2P', Arial, sans-serif;
      height: 100%;
      width: 100vw;
      /* Evita doble scroll en m√≥viles */
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
    }
    body {
      width: 100vw;
      height: 100vh;
      min-height: 100vh;
      min-width: 100vw;
      box-sizing: border-box;
      position: relative;
      overflow: hidden;
      /* Evita doble scroll en m√≥viles */
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
    }
    h1 {
      margin: 0;
      font-size: 5vw;
      color: #fff;
      text-shadow: 2px 2px 0 #000;
      letter-spacing: 2px;
      z-index: 2;
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      pointer-events: none;
    }
    #mensaje {
      background: rgba(0,0,0,0.7);
      color: #fff;
      padding: 10px 18px;
      border-radius: 12px;
      display: inline-block;
      font-size: 4vw;
      box-shadow: 0 2px 8px #0006;
      min-width: 60vw;
      max-width: 90vw;
      z-index: 3;
      position: absolute;
      left: 50%;
      top: 60px;
      transform: translateX(-50%);
      text-align: center;
    }
    #gameCanvas {
      position: absolute;
      left: 0; top: 0;
      width: 100vw;
      height: 100vh;
      image-rendering: pixelated;
      z-index: 1;
      background: #232946;
      touch-action: none;
      /* Para que no se mueva al hacer scroll en m√≥vil */
      overscroll-behavior: contain;
    }
    .controles {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 18px;
      z-index: 10;
      width: 95vw;
      justify-content: center;
      flex-wrap: wrap;
      pointer-events: auto;
    }
    .control-btn {
      background: #232946;
      border: 3px solid #ff66a3;
      color: #ff66a3;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      font-size: 2.2rem;
      box-shadow: 0 2px 8px #0006;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 2px;
      transition: background 0.2s, color 0.2s;
      cursor: pointer;
      font-family: inherit;
      user-select: none;
    }
    .control-btn:active {
      background: #ff66a3;
      color: #232946;
    }
    .speed-btn {
      border: 3px solid #ffe066;
      color: #ffe066;
      background: #232946;
      margin-left: 8px;
      margin-right: 8px;
    }
    .speed-btn.active {
      background: #ffe066;
      color: #232946;
    }
    .msg-btn {
      border: 3px solid #fff700;
      color: #fff700;
      background: #232946;
      margin-left: 8px;
    }
    .msg-btn:active {
      background: #fff700;
      color: #232946;
    }
    @media (max-width: 600px) {
      h1 { font-size: 7vw; }
      #mensaje { font-size: 5vw; }
      .control-btn { width: 48px; height: 48px; font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <h1>üéÆ Pa' ti mi cachetona üíñ</h1>
  <div id="mensaje">Pa‚Äô ti mi cachetona hermosa üåπ</div>
  <canvas id="gameCanvas"></canvas>
  <div class="controles">
    <button id="btnLeft" class="control-btn">‚óÄÔ∏è</button>
    <button id="btnIdle" class="speed-btn control-btn" title="Quieto">‚è∏Ô∏è</button>
    <button id="btnWalk" class="speed-btn control-btn active" title="Caminar">üö∂</button>
    <button id="btnRun" class="speed-btn control-btn" title="Correr">üèÉ</button>
    <button id="btnRight" class="control-btn">‚ñ∂Ô∏è</button>
    <button id="btnMensaje" class="msg-btn control-btn" title="Nuevo mensajito">üíå</button>
  </div>
  <script>
    // --- CONFIGURACI√ìN ---
    const mensajes = [
      "Pa‚Äô ti mi cachetona hermosa üåπ",
      "Te extra√±o mucho üíñ",
      "Eres mi persona favorita üòò",
      "Siempre pienso en ti ü•∞",
      "¬°Sonr√≠e, mi amor! üòä",
      "T√∫ eres mi cielo üåà",
      "¬°Te amo infinito! üíû",
      "Eres mi pixel preferido üü™",
      "Quiero abrazarte ya ü´Ç",
      "¬°Eres mi raz√≥n de sonre√≠r! üòç"
    ];

    // --- CANVAS ---
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    ctx.imageSmoothingEnabled = false;

    // --- AJUSTAR CANVAS A PANTALLA ---
    function resizeCanvas() {
      // Usa window.innerHeight para evitar barras en m√≥vil
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      // Ajusta posici√≥n del personaje para que no quede tapado por controles
      player.y = canvas.height - player.height - 100;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // --- SPRITES (PERSONAJE) ---
    const sprites = {
      idle: new Image(),
      walk: new Image(),
      run: new Image()
    };
    sprites.idle.src = "sprites/idle.png";
    sprites.walk.src = "sprites/walk.png";
    sprites.run.src = "sprites/run.png";

    // --- PERSONAJE ---
    let player = {
      x: 100,
      y: 0,
      width: 48,
      height: 48,
      frame: 0,
      frameCount: 4,
      speed: 2,
      action: "walk"
    };
    let keys = { left: false, right: false, action: "walk" };

    // --- PAISAJE DIN√ÅMICO ---
    function getSkyState() {
      const now = new Date();
      const h = now.getHours() + now.getMinutes()/60;
      if (h >= 5 && h < 7) return "dawn";
      if (h >= 7 && h < 17) return "day";
      if (h >= 17 && h < 19) return "sunset";
      return "night";
    }

    // --- NUBES PIXELART ---
    function drawCloud(x, y, scale=1) {
      ctx.save();
      ctx.translate(x, y);
      ctx.scale(scale, scale);
      ctx.fillStyle = "#fff";
      ctx.fillRect(8, 16, 32, 16);
      ctx.fillRect(0, 24, 48, 16);
      ctx.fillRect(16, 8, 16, 16);
      ctx.restore();
    }

    // --- LUNA PIXELART ---
    function drawMoon(x, y, r=32) {
      ctx.save();
      ctx.translate(x, y);
      ctx.fillStyle = "#fffbe6";
      ctx.beginPath();
      ctx.arc(0, 0, r, 0, Math.PI*2);
      ctx.fill();
      ctx.globalCompositeOperation = "destination-out";
      ctx.beginPath();
      ctx.arc(r*0.3, 0, r*0.8, 0, Math.PI*2);
      ctx.fill();
      ctx.globalCompositeOperation = "source-over";
      ctx.restore();
    }

    // --- SOL PIXELART ---
    function drawSun(x, y, r=32) {
      ctx.save();
      ctx.translate(x, y);
      ctx.fillStyle = "#ffe066";
      ctx.beginPath();
      ctx.arc(0, 0, r, 0, Math.PI*2);
      ctx.fill();
      // rayos
      ctx.strokeStyle = "#ffe066";
      ctx.lineWidth = 4;
      for(let i=0;i<8;i++){
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.lineTo(Math.cos(i*Math.PI/4)*r*1.5, Math.sin(i*Math.PI/4)*r*1.5);
        ctx.stroke();
      }
      ctx.restore();
    }

    // --- CORAZONES PIXELART ROJOS Y GRANDES ---
    function drawHeart(x, y, scale=2) {
      ctx.save();
      ctx.translate(x, y);
      ctx.scale(scale, scale);
      ctx.fillStyle = "#e63946";
      // Pixelart coraz√≥n (16x16)
      ctx.fillRect(2,4,4,4);
      ctx.fillRect(0,8,4,4);
      ctx.fillRect(2,12,4,4);
      ctx.fillRect(10,4,4,4);
      ctx.fillRect(12,8,4,4);
      ctx.fillRect(10,12,4,4);
      ctx.fillRect(4,2,8,4);
      ctx.fillRect(4,6,8,10);
      ctx.restore();
    }

    // --- ESTRELLAS PIXELART ---
    function drawStar(x, y, bright=1) {
      ctx.save();
      ctx.globalAlpha = bright;
      ctx.fillStyle = "#fff";
      ctx.fillRect(x, y, 4, 4);
      ctx.fillRect(x-2, y+2, 2, 2);
      ctx.fillRect(x+4, y+2, 2, 2);
      ctx.restore();
    }

    // --- AVES PIXELART ---
    function drawBird(x, y, scale=2, flip=false) {
      ctx.save();
      ctx.translate(x, y);
      ctx.scale(flip ? -scale : scale, scale);
      ctx.fillStyle = "#222";
      ctx.fillRect(0, 0, 8, 2);
      ctx.fillRect(6, -2, 2, 2);
      ctx.fillRect(6, 2, 2, 2);
      ctx.restore();
    }

    // --- ESTRELLA FUGAZ PIXELART ---
    function drawShootingStar(star) {
      ctx.save();
      ctx.globalAlpha = star.alpha;
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(star.x, star.y);
      ctx.lineTo(star.x - star.length * Math.cos(star.angle), star.y - star.length * Math.sin(star.angle));
      ctx.stroke();
      ctx.globalAlpha = star.alpha * 0.7;
      ctx.strokeStyle = "#ffe066";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(star.x, star.y);
      ctx.lineTo(star.x - (star.length-20) * Math.cos(star.angle), star.y - (star.length-20) * Math.sin(star.angle));
      ctx.stroke();
      ctx.restore();
    }

    // --- ESTADO DEL PAISAJE ---
    let clouds = [
      {x: 0.1, y: 0.12, s: 0.18, dx: 0.0008},
      {x: 0.4, y: 0.08, s: 0.13, dx: 0.0006},
      {x: 0.7, y: 0.16, s: 0.15, dx: 0.0004}
    ];
    let hearts = Array.from({length: 12}, () => ({
      x: Math.random(), y: Math.random(), s: 1.5+Math.random()*1.5, speed: 0.0002+Math.random()*0.0003
    }));

    // --- AVES ---
    let birds = Array.from({length: 5}, () => ({
      x: Math.random(), y: 0.08+Math.random()*0.12, speed: 0.0005+Math.random()*0.0005, flip: Math.random()>0.5
    }));

    // --- ESTRELLAS ---
    let stars = Array.from({length: 60}, () => ({
      x: Math.random(), y: Math.random()*0.25, bright: Math.random()
    }));

    // --- ESTRELLA FUGAZ ---
    let shootingStar = null;
    let lastShooting = 0;

    // --- MENSAJE ALEATORIO ---
    function nuevoMensaje() {
      let msg = mensajes[Math.floor(Math.random()*mensajes.length)];
      document.getElementById("mensaje").innerText = msg;
      if(getSkyState() === "night" || getSkyState() === "sunset") lanzarEstrellaFugaz();
    }

    // --- LANZAR ESTRELLA FUGAZ ---
    function lanzarEstrellaFugaz() {
      let fromLeft = Math.random() > 0.5;
      let yStart = Math.random()*canvas.height*0.3+20;
      let angle = (fromLeft ? Math.random()*0.5+0.2 : Math.PI-Math.random()*0.5-0.2);
      shootingStar = {
        x: fromLeft ? -40 : canvas.width+40,
        y: yStart,
        vx: Math.cos(angle)*16,
        vy: Math.sin(angle)*16,
        alpha: 1,
        angle: angle,
        length: 100+Math.random()*40
      };
      lastShooting = Date.now();
    }

    // --- CONTROLES T√ÅCTILES Y BOTONES ---
    function addBtnEvents(btn, onDown, onUp) {
      btn.onmousedown = onDown;
      btn.onmouseup = onUp;
      btn.ontouchstart = (e) => { e.preventDefault(); onDown(); };
      btn.ontouchend = (e) => { e.preventDefault(); onUp(); };
    }
    addBtnEvents(document.getElementById("btnLeft"), () => { keys.left = true; }, () => { keys.left = false; });
    addBtnEvents(document.getElementById("btnRight"), () => { keys.right = true; }, () => { keys.right = false; });

    // --- VELOCIDAD Y ACCI√ìN ---
    function setAction(action) {
      keys.action = action;
      document.querySelectorAll('.speed-btn').forEach(btn => btn.classList.remove('active'));
      if(action === "idle") document.getElementById("btnIdle").classList.add('active');
      if(action === "walk") document.getElementById("btnWalk").classList.add('active');
      if(action === "run") document.getElementById("btnRun").classList.add('active');
    }
    document.getElementById("btnIdle").onclick = () => setAction("idle");
    document.getElementById("btnWalk").onclick = () => setAction("walk");
    document.getElementById("btnRun").onclick = () => setAction("run");
    document.getElementById("btnMensaje").onclick = nuevoMensaje;

    // --- ANIMACI√ìN PRINCIPAL ---
    let frameTimer = 0;
    function update() {
      frameTimer++;
      // --- Animaci√≥n personaje ---
      if (frameTimer % 10 === 0) player.frame = (player.frame + 1) % player.frameCount;
      // --- Movimiento personaje ---
      let spd = player.speed * (keys.action === "run" ? 2.2 : keys.action === "walk" ? 1 : 0);
      if (keys.left) player.x -= spd;
      if (keys.right) player.x += spd;
      player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
      // Ajusta posici√≥n del personaje para que no quede tapado por controles
      player.y = canvas.height - player.height - 100;
      player.action = keys.action;

      // --- Animar nubes ---
      clouds.forEach(cl => {
        cl.x += cl.dx;
        if (cl.x > 1.1) cl.x = -0.2;
      });

      // --- Animar corazones flotando ---
      hearts.forEach(h => {
        h.y -= h.speed;
        if (h.y < -0.1) {
          h.y = 1.1;
          h.x = Math.random();
        }
      });

      // --- Animar aves ---
      if(getSkyState() === "day" || getSkyState() === "dawn") {
        birds.forEach(b => {
          b.x += b.speed * (b.flip ? -1 : 1);
          if (b.x > 1.1) { b.x = -0.1; b.y = 0.08+Math.random()*0.12; b.flip = false; }
          if (b.x < -0.1) { b.x = 1.1; b.y = 0.08+Math.random()*0.12; b.flip = true; }
        });
      }

      // --- Animar estrellas titilando ---
      if (getSkyState() === "sunset" || getSkyState() === "night") {
        stars.forEach(s => {
          s.bright += (Math.random()-0.5)*0.1;
          s.bright = Math.max(0.3, Math.min(1, s.bright));
        });
      }

      // --- Estrella fugaz autom√°tica cada 8s solo de noche/sunset ---
      if ((getSkyState() === "night" || getSkyState() === "sunset") && !shootingStar && Date.now() - lastShooting > 8000) lanzarEstrellaFugaz();

      // --- Animar estrella fugaz ---
      if (shootingStar) {
        shootingStar.x += shootingStar.vx;
        shootingStar.y += shootingStar.vy;
        shootingStar.alpha -= 0.012;
        if (
          shootingStar.alpha <= 0 ||
          shootingStar.x < -80 || shootingStar.x > canvas.width+80 ||
          shootingStar.y < -40 || shootingStar.y > canvas.height*0.5
        ) shootingStar = null;
      }

      draw();
      requestAnimationFrame(update);
    }

    // --- DIBUJAR TODO ---
    function draw() {
      // --- Fondo cielo seg√∫n hora ---
      let sky = getSkyState();
      if (sky === "dawn") {
        let grad = ctx.createLinearGradient(0,0,0,canvas.height);
        grad.addColorStop(0, "#f9d29d");
        grad.addColorStop(1, "#a1c4fd");
        ctx.fillStyle = grad;
      } else if (sky === "day") {
        ctx.fillStyle = "#87ceeb";
      } else if (sky === "sunset") {
        let grad = ctx.createLinearGradient(0,0,0,canvas.height);
        grad.addColorStop(0, "#fcb69f");
        grad.addColorStop(1, "#a1c4fd");
        ctx.fillStyle = grad;
      } else {
        ctx.fillStyle = "#232946";
      }
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // --- Sol/Luna ---
      if (sky === "dawn") drawSun(canvas.width-80, 80, 40);
      if (sky === "day") drawSun(canvas.width-80, 60, 40);
      if (sky === "sunset") drawSun(canvas.width-80, 120, 40);
      if (sky === "night") drawMoon(canvas.width-80, 60, 40);

      // --- Nubes ---
      if (sky !== "night") clouds.forEach(cl => drawCloud(cl.x*canvas.width, cl.y*canvas.height, cl.s*canvas.width/100));
      else clouds.forEach(cl => drawCloud(cl.x*canvas.width, cl.y*canvas.height, cl.s*canvas.width/120));

      // --- Estrellas ---
      if (sky === "sunset" || sky === "night") {
        stars.forEach(s => drawStar(s.x*canvas.width, s.y*canvas.height, s.bright));
      }

      // --- Estrella fugaz ---
      if (shootingStar) drawShootingStar(shootingStar);

      // --- Aves (solo de d√≠a y amanecer) ---
      if(sky === "day" || sky === "dawn") {
        birds.forEach(b => drawBird(b.x*canvas.width, b.y*canvas.height, 2.5, b.flip));
      }

      // --- Corazones flotando pixelart ---
      hearts.forEach(h => drawHeart(h.x*canvas.width, h.y*canvas.height, h.s*canvas.width/600));

      // --- Personaje ---
      let sprite = sprites[player.action];
      ctx.drawImage(
        sprite,
        player.frame * player.width, 0, player.width, player.height,
        player.x, player.y, player.width, player.height
      );
    }

    // --- INICIAR ---
    document.getElementById("mensaje").onclick = nuevoMensaje;
    update();
  </script>
</body>
</html>